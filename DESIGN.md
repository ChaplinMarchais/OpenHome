# OpenHome Design Document

The top level design of the OpenHome system revolves around a central Flask server application which is responsible for providing HTTP and WebSocket endpoints for the UI and the IoT devices to communicate with. The second major component of the system is the OpenHomeSDK library which contains the code to allow a client device running Python to connect to the server for registration and status updates.

The server must support a method of authenticating a user and storing their identity in memory. To solve this problem I have integrated with the Auth0 service. I chose to use a library for Flask called Authlib which allows for simple integration of the OIDC protocols. I then utilize the UUID library to generate a GUID for each user when they are first registered and store it in the Users table associated with their OpenID_Sub field from the OIDC token returned from Auth0's login endpoint. This allows for a way to match a given user account with their endpoint devices they are registering with the server.

Handling device integration was the most challenging aspect of the project because I needed to find a way to allow bi-directional communication with the devices. The option that I chose to accomplish this was the use of WebSockets. I adopted a library called flask-sock which provides wrappers that work the same as the standard `app.route()` wrapper but implements the WS protocol rather than HTTP.

I have a connect endpoint which the OpenHomeSDK library function attempts to connect to by forming a JSON payload including the users `device_code` and the name of the device along with the message action type field which allows for the server to support multiple use cases from a single endpoint. I went with this strategy so that future functionality can be added much more easily by simply extending the JSON message protocol to support and action other than the default `connect`. This will allow for a device to create and define it's own UI to be displayed through the frontend which allows for all of the feature of the device to be controlled from the platform. Sadly I have ran out of time to implement this final feature but all the ground work is there to continue my work after submitting the final.